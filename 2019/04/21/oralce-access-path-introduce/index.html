<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ORACLE,SQL优化," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="&amp;emsp;本文梳理、归纳了在之前工作中常见的一些执行计划。了解ORACLE中有哪些可能的执行计划，以及什么情况下适合哪种执行计划是进行SQL优化的基础。">
<meta name="keywords" content="ORACLE,SQL优化">
<meta property="og:type" content="article">
<meta property="og:title" content="ORACLE中的常见执行计划">
<meta property="og:url" content="http://yoursite.com/2019/04/21/oralce-access-path-introduce/index.html">
<meta property="og:site_name" content="木乃伊、">
<meta property="og:description" content="&amp;emsp;本文梳理、归纳了在之前工作中常见的一些执行计划。了解ORACLE中有哪些可能的执行计划，以及什么情况下适合哪种执行计划是进行SQL优化的基础。">
<meta property="og:updated_time" content="2019-04-23T06:15:02.966Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ORACLE中的常见执行计划">
<meta name="twitter:description" content="&amp;emsp;本文梳理、归纳了在之前工作中常见的一些执行计划。了解ORACLE中有哪些可能的执行计划，以及什么情况下适合哪种执行计划是进行SQL优化的基础。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/21/oralce-access-path-introduce/"/>





  <title>ORACLE中的常见执行计划 | 木乃伊、</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">木乃伊、</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">不务正业的CODER，当了一个假的DBA</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/21/oralce-access-path-introduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="L4J">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="木乃伊、">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ORACLE中的常见执行计划</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-21T15:00:47+08:00">
                2019-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ORACLE/" itemprop="url" rel="index">
                    <span itemprop="name">ORACLE</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>&emsp;本文梳理、归纳了在之前工作中常见的一些执行计划。了解ORACLE中有哪些可能的执行计划，以及什么情况下适合哪种执行计划是进行SQL优化的基础。<br><a id="more"></a></p>
<h3 id="表访问相关"><a href="#表访问相关" class="headerlink" title="表访问相关"></a>表访问相关</h3><h4 id="Full-Table-Scans"><a href="#Full-Table-Scans" class="headerlink" title="Full Table Scans"></a>Full Table Scans</h4><p>&emsp;全表扫描首先会读取表中的所有行，然后过滤掉不满足条件的数据。全表扫描时，数据库会以此读取HWM下的所有格式化了的数据块，此时数据库通常会做multiblock read来提高性能，单次读取的数据块由<code>DB_FILE_MULTIBLOCK_READ_COUNT</code>参数指定。<br>&emsp;以下情况会做全表扫描：</p>
<ol>
<li>查询列上不存在索引</li>
<li>在索引列上使用了函数</li>
<li>执行SELECT COUNT(*)语句，存在索引，但是索引包含空值</li>
<li>未使用B-TREE索引的前导列。如存在employees(first_name,last_name)的索引，但是查询条件为WHERE last_name=’KING’。但是优化器有可能选择index skip scan</li>
<li>查询选择性很低的时候</li>
<li>统计信息陈旧</li>
<li>当表很小的时候，包含的数据块数n小于DB_FILE_MULTIBLOCK_READ_COUNT参数指定的值</li>
<li>当表具有很高的并行度的时候</li>
<li>使用了FULL的hints</li>
</ol>
<p>&emsp;下面是一个做全表扫描的列子，其执行计划的关键字为’TABLE ACCESS FULL’：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> owner=<span class="string">'AUDSYS'</span>;</div><div class="line"></div><div class="line">OWNER                TABLE_NAME</div><div class="line">-------------------- ------------------------------</div><div class="line">AUDSYS               AUD<span class="variable">$UNIFIED</span></div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> owner=<span class="string">'AUDSYS'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 1475094007</div><div class="line"></div><div class="line">-------------------------------------------</div><div class="line">| Id  | Operation         | Name          |</div><div class="line">-------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT  |               |</div><div class="line">|   1 |  TABLE ACCESS FULL| TB_TABLE_LIST |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<h4 id="Table-Access-By-Rowid"><a href="#Table-Access-By-Rowid" class="headerlink" title="Table Access By Rowid"></a>Table Access By Rowid</h4><p>&emsp;ROWID是数据在数据库中存储位置的内部表示，它是用来定位单个行最快的方式。通常数据库通过索引检索数据行或者指定rowid查询的时候会使用这种访问方式。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> TABLE_NAME=<span class="string">'ACCESS$'</span>;</div><div class="line"></div><div class="line">OWNER                TABLE_NAME</div><div class="line">-------------------- ------------------------------</div><div class="line">SYS                  ACCESS$</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name from test_env.tb_table_list <span class="built_in">where</span></div><div class="line">TABLE_NAME=<span class="string">'ACCESS$'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3473397811</div><div class="line"></div><div class="line">------------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                     |</div><div class="line">------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                          |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST            |</div><div class="line">|   2 |   INDEX RANGE SCAN                  | IDX_TB_TABLE_LIST_TBNAME |</div><div class="line">------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>&emsp;<code>TABLE ACCESS BY INDEX ROWID BATCHED</code>表示数据库通过索引中得到的rowid来检索数据，<code>BATCHED</code>的访问方式，表示数据库会从索引中检索一批ROWID，然后按块顺序访问行，减少访问数据块的次数来提升性能。这是ORACLE 12C的一个新特性。在11g中上面的执行计划表示为<code>TABLE ACCESS BY INDEX ROWID</code>。</p>
<h4 id="Sample-Table-Scans"><a href="#Sample-Table-Scans" class="headerlink" title="Sample Table Scans"></a>Sample Table Scans</h4><p>&emsp;这是抽样检索数据的数据访问方式。使用SAMPLE关键字对表中数据进行抽样的时候会使用该执行计划，在执行计划中表现为<code>TABLE ACCESS SAMPLE</code>关键字。它有以下两种形式:</p>
<ol>
<li>SAMPLE (sample_percent)<br>数据库读取表中指定百分比的行数据。</li>
<li>SAMPLE BLOCK (sample_percent)<br>数据库会读取指定百分比的表数据块。</li>
</ol>
<p>&emsp;sample_percent的百分比在[0.000001,100) 范围内。</p>
<h3 id="B-tree索引相关"><a href="#B-tree索引相关" class="headerlink" title="B-tree索引相关"></a>B-tree索引相关</h3><h4 id="Index-Unique-Scans"><a href="#Index-Unique-Scans" class="headerlink" title="Index Unique Scans"></a>Index Unique Scans</h4><p>&emsp;只有通过<code>CREATE UNIQUE INDEX</code>创建唯一索引，并且在查询的时候谓词条件为等于的时候才会以该方式访问数据。唯一约束(unique和primary key)，但是创建的非唯一索引是不足以让查询走Index Unique Scan的。在执行计划中的关键字是<code>INDEX UNIQUE SCAN</code>。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">SQL&gt; CREATE UNIQUE INDEX TEST_ENV.IDX_TB_TABLE_LIST_SID ON TEST_ENV.TB_TABLE_LIST(SID);</div><div class="line"></div><div class="line">索引已创建。</div><div class="line"></div><div class="line">SQL&gt; SELECT SID,OWNER,TABLE_NAME FROM TEST_ENV.TB_TABLE_LIST WHERE SID=<span class="string">'58223719640640AB8C603BC1B15D5C51'</span>;</div><div class="line"></div><div class="line">SID                                  OWNER                TABLE_NAME</div><div class="line">------------------------------------ -------------------- ------------------------------</div><div class="line">58223719640640AB8C603BC1B15D5C51     SYS                  ACCESS$</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">SELECT SID,OWNER,TABLE_NAME FROM TEST_ENV.TB_TABLE_LIST WHERE</div><div class="line">SID=<span class="string">'58223719640640AB8C603BC1B15D5C51'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3115192837</div><div class="line"></div><div class="line">-------------------------------------------------------------</div><div class="line">| Id  | Operation                   | Name                  |</div><div class="line">-------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT            |                       |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID| TB_TABLE_LIST         |</div><div class="line">|   2 |   INDEX UNIQUE SCAN         | IDX_TB_TABLE_LIST_SID |</div><div class="line">-------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 15 行。</div></pre></td></tr></table></figure></p>
<h4 id="Index-Range-Scans"><a href="#Index-Range-Scans" class="headerlink" title="Index Range Scans"></a>Index Range Scans</h4><p>&emsp;通过该索引字段查询结果可能返回多个值的时候，例如&gt;, &lt;, and以及对非唯一索引的=，就会以该方式访问数据，表现在执行计划上就是<code>INDEX RANGE SCAN</code>关键字。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> TABLE_NAME=<span class="string">'ACCESS$'</span>;</div><div class="line"></div><div class="line">OWNER                TABLE_NAME</div><div class="line">-------------------- ------------------------------</div><div class="line">SYS                  ACCESS$</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name from test_env.tb_table_list <span class="built_in">where</span></div><div class="line">TABLE_NAME=<span class="string">'ACCESS$'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3473397811</div><div class="line"></div><div class="line">------------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                     |</div><div class="line">------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                          |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST            |</div><div class="line">|   2 |   INDEX RANGE SCAN                  | IDX_TB_TABLE_LIST_TBNAME |</div><div class="line">------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<h4 id="Index-Full-Scans"><a href="#Index-Full-Scans" class="headerlink" title="Index Full Scans"></a>Index Full Scans</h4><p>&emsp;索引全扫描会有序的读取整个索引，由于索引是有序的，所以它会消除额外的排序操作。 以下情况会优化器会考虑执行索引全扫描：</p>
<ul>
<li>谓词使用了索引中的列。该列不必是索引的前导列</li>
<li>没有谓词条件，但是查询的列为该索引的列，并且至少有一个列不为空</li>
<li>查询包含ORDER BY 语句并且排序字段为非空且有索引</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select table_name from test_env.tb_table_list order by table_name;</div><div class="line">......</div><div class="line"></div><div class="line">TABLE_NAME</div><div class="line">------------------------------</div><div class="line">XSTREAM<span class="variable">$_SERVER_CONNECTION</span></div><div class="line">XSTREAM<span class="variable">$_SUBSET_RULES</span></div><div class="line">XSTREAM<span class="variable">$_SYSGEN_OBJS</span></div><div class="line">_default_auditing_options_</div><div class="line"></div><div class="line">已选择 2138 行。</div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select table_name from test_env.tb_table_list order by table_name</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 2901892796</div><div class="line"></div><div class="line">-----------------------------------------------------</div><div class="line">| Id  | Operation        | Name                     |</div><div class="line">-----------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT |                          |</div><div class="line">|   1 |  INDEX FULL SCAN | IDX_TB_TABLE_LIST_TBNAME |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------</div></pre></td></tr></table></figure>
<h4 id="Index-Fast-Full-Scans"><a href="#Index-Fast-Full-Scans" class="headerlink" title="Index Fast Full Scans"></a>Index Fast Full Scans</h4><p>&emsp;当查询的列仅仅包含索引列，且不需要排序的时候，优化器会考虑该访问方式，它会以磁盘存储位置来读取，不会保证数据的有序性。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select table_name from test_env.tb_table_list;</div><div class="line"></div><div class="line">TABLE_NAME</div><div class="line">------------------------------</div><div class="line">XSTREAM<span class="variable">$_SERVER_CONNECTION</span></div><div class="line">XSTREAM<span class="variable">$_SUBSET_RULES</span></div><div class="line">XSTREAM<span class="variable">$_SYSGEN_OBJS</span></div><div class="line">_default_auditing_options_</div><div class="line"></div><div class="line">已选择 2138 行。</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">---------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select table_name from test_env.tb_table_list</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3670592075</div><div class="line"></div><div class="line">---------------------------------------------------------</div><div class="line">| Id  | Operation            | Name                     |</div><div class="line">---------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT     |                          |</div><div class="line">|   1 |  INDEX FAST FULL SCAN| IDX_TB_TABLE_LIST_TBNAME |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">---------------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<h4 id="Index-Skip-Scans"><a href="#Index-Skip-Scans" class="headerlink" title="Index Skip Scans"></a>Index Skip Scans</h4><p>&emsp;在复合索引中未使用前导列的情况，并且前导列只存在很少的distinct value。其在执行计划中表现为<code>INDEX SKIP SCAN</code>。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create index test_env.idx_tb_table_list_mul on test_env.tb_table_list(owner,table_name);</div><div class="line"></div><div class="line">索引已创建。</div><div class="line">SQL&gt; select /*+ index(t idx_tb_table_list_mul) */sid,owner,table_name,status from test_env.tb_table_list t <span class="built_in">where</span> table_name=<span class="string">'ACCESS$'</span>;</div><div class="line"></div><div class="line">SID                                  OWNER                TABLE_NAME                     STATUS</div><div class="line">------------------------------------ -------------------- ------------------------------ --------</div><div class="line">58223719640640AB8C603BC1B15D5C51     SYS                  ACCESS$                        VALID</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select /*+ index(t idx_tb_table_list_mul) */sid,owner,table_name,status</div><div class="line">from test_env.tb_table_list t <span class="built_in">where</span> table_name=<span class="string">'ACCESS$'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 124701251</div><div class="line"></div><div class="line">---------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                  |</div><div class="line">---------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                       |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST         |</div><div class="line">|   2 |   INDEX SKIP SCAN                   | IDX_TB_TABLE_LIST_MUL |</div><div class="line">---------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<h4 id="Index-Join-Scans"><a href="#Index-Join-Scans" class="headerlink" title="Index Join Scans"></a>Index Join Scans</h4><p>&emsp;对同一个表，多个索引的hash join。当查询结果都是索引中的列，并且存在于不同索引中时会考虑使用该数据访问方式，但是如果访问表的效率更高则会根据rowid去访问表。<br>&emsp;Index join的成本是非常的，绝大多数情况下是不会出现这种情况，通过索引去探测表通常成本更低。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> ini_trans&gt;=4;</div><div class="line"></div><div class="line">OWNER           TABLE_NAME</div><div class="line">--------------- ------------------------------</div><div class="line">MDSYS           SDO_DIST_METADATA_TABLE</div><div class="line">SYS             AW<span class="variable">$AWCREATE</span></div><div class="line">SYS             AW<span class="variable">$AWCREATE10G</span></div><div class="line">SYS             AW<span class="variable">$AWMD</span></div><div class="line">SYS             AW<span class="variable">$AWREPORT</span></div><div class="line">SYS             AW<span class="variable">$AWXML</span></div><div class="line">SYS             AW<span class="variable">$EXPRESS</span></div><div class="line">SYS             AW_OBJ$</div><div class="line">SYS             AW_PROP$</div><div class="line">SYS             OBJECT_USAGE</div><div class="line">SYS             PS$</div><div class="line"></div><div class="line">OWNER           TABLE_NAME</div><div class="line">--------------- ------------------------------</div><div class="line">SYS             STREAMS<span class="variable">$_APPLY_PROGRESS</span></div><div class="line"></div><div class="line">已选择 12 行。</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name from test_env.tb_table_list <span class="built_in">where</span> ini_trans&gt;=4</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 832528447</div><div class="line"></div><div class="line">---------------------------------------------------------------------</div><div class="line">| Id  | Operation                     | Name                        |</div><div class="line">---------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT              |                             |</div><div class="line">|   1 |  VIEW                         | index<span class="variable">$_join</span><span class="variable">$_001</span>            |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   2 |   HASH JOIN                   |                             |</div><div class="line">|   3 |    BITMAP CONVERSION TO ROWIDS|                             |</div><div class="line">|   4 |     BITMAP INDEX RANGE SCAN   | BIDX_TB_TABLE_LIST_INITRANS |</div><div class="line">|   5 |    INDEX FAST FULL SCAN       | IDX_TB_TABLE_LIST_MUL       |</div><div class="line">---------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 17 行。</div></pre></td></tr></table></figure></p>
<h3 id="Bitmap索引相关"><a href="#Bitmap索引相关" class="headerlink" title="Bitmap索引相关"></a>Bitmap索引相关</h3><p>&emsp;传统的B-tree索引，一条索引对应一条数据。Bitmap的一个索引的键值通常对应一批rowid。<br>&emsp;Bitmap索引适用于拥有较低distinct基数并且不经常修改的数据。Bitmap索引不适用于经常进行DML操作的列，因为一个index key指向很多数据行，当对一个索引的列进行修改时，会锁住整个索引条目以及对应的数据行。 还需要注意的一点就是Bitmap索引列是可以包含空值的。</p>
<h4 id="Bitmap-Conversion-to-Rowid"><a href="#Bitmap-Conversion-to-Rowid" class="headerlink" title="Bitmap Conversion to Rowid"></a>Bitmap Conversion to Rowid</h4><p>&emsp;只要从位图索引中检索行，就会用到该访问方式，进行数据行与bitmap之间的转换。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name,status,ini_trans from test_env.tb_table_list <span class="built_in">where</span> ini_trans&gt;=4;</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     STATUS      INI_TRANS</div><div class="line">--------------- ------------------------------ ---------- ----------</div><div class="line">SYS             PS$                            VALID               4</div><div class="line">SYS             AW_OBJ$                        VALID               4</div><div class="line">SYS             AW_PROP$                       VALID               4</div><div class="line">SYS             AW<span class="variable">$EXPRESS</span>                     VALID               4</div><div class="line">SYS             AW<span class="variable">$AWMD</span>                        VALID               4</div><div class="line">SYS             AW<span class="variable">$AWCREATE</span>                    VALID               4</div><div class="line">SYS             AW<span class="variable">$AWCREATE10G</span>                 VALID               4</div><div class="line">SYS             AW<span class="variable">$AWXML</span>                       VALID               4</div><div class="line">SYS             AW<span class="variable">$AWREPORT</span>                    VALID               4</div><div class="line">SYS             OBJECT_USAGE                   VALID              30</div><div class="line">SYS             STREAMS<span class="variable">$_APPLY_PROGRESS</span>        VALID             120</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     STATUS      INI_TRANS</div><div class="line">--------------- ------------------------------ ---------- ----------</div><div class="line">MDSYS           SDO_DIST_METADATA_TABLE        VALID             255</div><div class="line"></div><div class="line">已选择 12 行。</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name,status,ini_trans from test_env.tb_table_list</div><div class="line"><span class="built_in">where</span> ini_trans&gt;=4</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3195249317</div><div class="line"></div><div class="line">---------------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                        |</div><div class="line">---------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                             |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-----------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST               |</div><div class="line">|   2 |   BITMAP CONVERSION TO ROWIDS       |                             |</div><div class="line">|   3 |    BITMAP INDEX RANGE SCAN          | BIDX_TB_TABLE_LIST_INITRANS |</div><div class="line">---------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 16 行。</div></pre></td></tr></table></figure></p>
<h4 id="Bitmap-Index-Single-Value"><a href="#Bitmap-Index-Single-Value" class="headerlink" title="Bitmap Index Single Value"></a>Bitmap Index Single Value</h4><p>&emsp;使用bitmap索引的单个键值来查询数据的时候会走该访问方式，在执行计划中表现为<code>BITMAP INDEX SINGLE VALUE</code>关键字。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT OWNER,TABLE_NAME,TABLESPACE_NAME,STATUS FROM TEST_ENV.TB_TABLE_LIST WHERE TABLESPACE_NAME=<span class="string">'SYSTEM'</span>;</div><div class="line"></div><div class="line">....</div><div class="line">OWNER           TABLE_NAME                     TABLESPACE_NAME      STATUS</div><div class="line">--------------- ------------------------------ -------------------- ----------</div><div class="line">LBACSYS         OLS<span class="variable">$USER_LEVELS</span>                SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$USER_COMPARTMENTS</span>          SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$USER_GROUPS</span>                SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$PROFILES</span>                   SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$DIP_DEBUG</span>                  SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$DIP_EVENTS</span>                 SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$AUDIT</span>                      SYSTEM               VALID</div><div class="line">LBACSYS         OLS<span class="variable">$AUDIT_ACTIONS</span>              SYSTEM               VALID</div><div class="line">SYS             DBMS_SQLPATCH_STATE            SYSTEM               VALID</div><div class="line">SYS             DBMS_SQLPATCH_FILES            SYSTEM               VALID</div><div class="line">SYS             AQ_SRVNTFN_TABLE_1             SYSTEM               VALID</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     TABLESPACE_NAME      STATUS</div><div class="line">--------------- ------------------------------ -------------------- ----------</div><div class="line">SYS             REGISTRY<span class="variable">$SQLPATCH_RU_INFO</span>      SYSTEM               VALID</div><div class="line"></div><div class="line">已选择 912 行。</div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">SELECT OWNER,TABLE_NAME,TABLESPACE_NAME,STATUS FROM</div><div class="line">TEST_ENV.TB_TABLE_LIST WHERE TABLESPACE_NAME=<span class="string">'SYSTEM'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 4282437356</div><div class="line"></div><div class="line">-----------------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                          |</div><div class="line">-----------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                               |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST                 |</div><div class="line">|   2 |   BITMAP CONVERSION TO ROWIDS       |                               |</div><div class="line">|   3 |    BITMAP INDEX SINGLE VALUE        | BIDX_TB_TABLE_LIST_TABLESPACE |</div><div class="line">-----------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 16 行。</div></pre></td></tr></table></figure></p>
<h4 id="Bitmap-Index-Range-Scans"><a href="#Bitmap-Index-Range-Scans" class="headerlink" title="Bitmap Index Range Scans"></a>Bitmap Index Range Scans</h4><p>&emsp;当谓词条件在bitmap索引列上是一个范围值的时候，如<code>Bitmap Conversion to Rowid</code>中的例子，它在执行计划中表现为<code>BITMAP INDEX RANGE SCAN</code>关键字。</p>
<h4 id="Bitmap-Merge"><a href="#Bitmap-Merge" class="headerlink" title="Bitmap Merge"></a>Bitmap Merge</h4><p>&emsp;此访问路径合并多个Bitmap，并返回单个Bitmap作为结果。在执行计划中表现为<code>BITMAP MERGE</code>关键字<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select owner,table_name,status,ini_trans from test_env.tb_table_list <span class="built_in">where</span> ini_trans&gt;=4 and tablespace_name=<span class="string">'SYSTEM'</span>;</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     STATUS      INI_TRANS</div><div class="line">--------------- ------------------------------ ---------- ----------</div><div class="line">SYS             OBJECT_USAGE                   VALID              30</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name,status,ini_trans from test_env.tb_table_list</div><div class="line"><span class="built_in">where</span> ini_trans&gt;=4 and tablespace_name=<span class="string">'SYSTEM'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 1400915856</div><div class="line"></div><div class="line">-----------------------------------------------------------------------------</div><div class="line">| Id  | Operation                           | Name                          |</div><div class="line">-----------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                    |                               |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST                 |</div><div class="line">|   2 |   BITMAP CONVERSION TO ROWIDS       |                               |</div><div class="line">|   3 |    BITMAP AND                       |                               |</div><div class="line">|   4 |     BITMAP INDEX SINGLE VALUE       | BIDX_TB_TABLE_LIST_TABLESPACE |</div><div class="line">|   5 |     BITMAP MERGE                    |                               |</div><div class="line">|   6 |      BITMAP INDEX RANGE SCAN        | BIDX_TB_TABLE_LIST_INITRANS   |</div><div class="line">-----------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 19 行。</div></pre></td></tr></table></figure></p>
<h3 id="表连接相关"><a href="#表连接相关" class="headerlink" title="表连接相关"></a>表连接相关</h3><p>&emsp;在进行多表关联查询的时候，优化器需要考虑以下内容：</p>
<ul>
<li>数据访问方式<br>同单表查询一样，优化器必须选择是全表扫描还是通过索引来检索表中数据</li>
<li>关联方法<br>即如何对表进行关联。可能的关联方式有，hash join,nested loops,sorted merge。</li>
<li>关联类型<br>关联条件决定了关联的类型，如inner join，outer join等</li>
<li>关联的顺序<br>在进行表关联的时候，优化器需要决定先关联哪些表，哪个表作为驱动表。基本思想就是尽快的过滤掉尽可能多的数据。</li>
</ul>
<h4 id="Nested-Loops-Joins"><a href="#Nested-Loops-Joins" class="headerlink" title="Nested Loops Joins"></a>Nested Loops Joins</h4><p>&emsp;嵌套循环连接，可以理解为一个嵌套的for循环，通过外部表的每一条数据去匹配内部表的数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">FOR erow IN outer_table LOOP</div><div class="line">  FOR drow IN inner_table LOOP</div><div class="line">    <span class="built_in">return</span> match value</div><div class="line">  END LOOP</div><div class="line">END LOOP</div></pre></td></tr></table></figure></p>
<p>&emsp;嵌套循环连接适用于以下情况：</p>
<ul>
<li>数据集很小的时候</li>
<li>在FIRST_ROW的优化器模式下关联大表</li>
<li>关联条件可以高效的访问内部表</li>
</ul>
<p>&emsp;一般情况下，只有在数据集比较小并且关联条件存在索引的时候会使用该方式。也可以通过加入以下hints的方式来强制走嵌套训话连接。：</p>
<ul>
<li>USE_NL_WITH_INDEX(table index) 由优化器决定那个表作为驱动表，index是可选的，不指定则由优化器决定</li>
<li>ORDERED USE_NL(d) 指定内部表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select /*+ORDERED USE_NL(B) */A.owner,A.table_name,A.column_name from TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B WHERE A.TABLE_NAME=B.TABLE_NAME AND B.TABLE_NAME=<span class="string">'ACCESS$'</span>;</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     COLUMN_NAME</div><div class="line">--------------- ------------------------------ --------------------</div><div class="line">SYS             ACCESS$                        D_OBJ<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        ORDER<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        COLUMNS</div><div class="line">SYS             ACCESS$                        TYPES</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select /*+ORDERED USE_NL(B) */A.owner,A.table_name,A.column_name from</div><div class="line">TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B WHERE</div><div class="line">A.TABLE_NAME=B.TABLE_NAME AND B.TABLE_NAME=<span class="string">'ACCESS$'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 1684280275</div><div class="line"></div><div class="line">----------------------------------------------------------------------</div><div class="line">| Id  | Operation                            | Name                  |</div><div class="line">----------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   0 | SELECT STATEMENT                     |                       |</div><div class="line">|   1 |  NESTED LOOPS                        |                       |</div><div class="line">|   2 |   TABLE ACCESS BY INDEX ROWID BATCHED| TB_COLUMN_LIST        |</div><div class="line">|   3 |    INDEX RANGE SCAN                  | TB_COLUMN_LIST_TBNAME |</div><div class="line">|   4 |   INDEX RANGE SCAN                   | TB_TABLE_LIST_TBNAME  |</div><div class="line">----------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 18 行。</div></pre></td></tr></table></figure>
<h4 id="Hash-Joins"><a href="#Hash-Joins" class="headerlink" title="Hash Joins"></a>Hash Joins</h4><p>&emsp;这是大数据集关联的常见方式，也是我们日常见得最多的关联方式。优化器会选择两个数据集中较小的一个表，然后用关联字段来构建hash表，存放在PGA中(如果PGA大小不够存放该hash表，则会将部分数据放入到临时表中)，然后，数据库扫描较大的数据集，探测哈希表以查找满足连接条件的数据行。<br>&emsp;同意通过<code>USE_HASH</code>的hints来强制数据库走HASH连接。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select /*+USE_HASH(A B) */A.owner,A.table_name,A.column_name from TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST</div><div class="line">B WHERE A.TABLE_NAME=B.TABLE_NAME AND A.OWNER=B.OWNER AND B.TABLE_NAME=<span class="string">'ACCESS$'</span>;</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     COLUMN_NAME</div><div class="line">--------------- ------------------------------ --------------------</div><div class="line">SYS             ACCESS$                        D_OBJ<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        ORDER<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        COLUMNS</div><div class="line">SYS             ACCESS$                        TYPES</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select /*+USE_HASH(A B) */A.owner,A.table_name,A.column_name from</div><div class="line">TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B WHERE</div><div class="line">A.TABLE_NAME=B.TABLE_NAME AND A.OWNER=B.OWNER AND B.TABLE_NAME=<span class="string">'ACCESS$'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 209128112</div><div class="line"></div><div class="line">----------------------------------------------------------------------</div><div class="line">| Id  | Operation                            | Name                  |</div><div class="line">----------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   0 | SELECT STATEMENT                     |                       |</div><div class="line">|   1 |  HASH JOIN                           |                       |</div><div class="line">|   2 |   TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST         |</div><div class="line">|   3 |    INDEX RANGE SCAN                  | TB_TABLE_LIST_TBNAME  |</div><div class="line">|   4 |   TABLE ACCESS BY INDEX ROWID BATCHED| TB_COLUMN_LIST        |</div><div class="line">|   5 |    INDEX RANGE SCAN                  | TB_COLUMN_LIST_TBNAME |</div><div class="line">----------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 19 行。</div></pre></td></tr></table></figure></p>
<h4 id="Sorted-Merge-Joins"><a href="#Sorted-Merge-Joins" class="headerlink" title="Sorted Merge Joins"></a>Sorted Merge Joins</h4><p>&emsp;这是Nested Loops的一个变种。数据库会首先执行<code>SORT JOIN</code>操作对两个数据集进行排序，然后遍历外部数据集的每一行，去匹配内部数据集，第二次开始后面每次的匹配位置，取决于前一次迭代的匹配。<br>&emsp;以下情况会选择进行Sorted Merge：</p>
<ul>
<li>连接条件不是等值连接，如&gt;,&lt;&gt;</li>
<li>由于其他操作需要排序，优化器发现使用排序合并成本更低。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select A.owner,A.table_name,A.column_name from TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B WHERE A.TABLE_NAME=B.TABLE_NAME AND A.OWNER=B.OWNER AND B.TABLE_NAME=<span class="string">'ACCESS$'</span> ORDER BY TABLE_NAME;</div><div class="line"></div><div class="line">.... </div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     COLUMN_NAME</div><div class="line">--------------- ------------------------------ --------------------</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE5</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE4</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE3</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE2</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE6</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           OBJECT_TYPE</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           OBJECT_NAME</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           OBJECT_OWNER</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SERVER_NAME</div><div class="line">SYS             XSTREAM<span class="variable">$_SYSGEN_OBJS</span>           SPARE1</div><div class="line">SYS             _default_auditing_options_     A</div><div class="line"></div><div class="line">已选择 23104 行。</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select A.owner,A.table_name,A.column_name from TEST_ENV.TB_COLUMN_LIST</div><div class="line">A,TEST_ENV.TB_TABLE_LIST B WHERE A.TABLE_NAME=B.TABLE_NAME AND</div><div class="line">A.OWNER=B.OWNER ORDER BY TABLE_NAME</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3270676555</div><div class="line"></div><div class="line">---------------------------------------------------</div><div class="line">| Id  | Operation              | Name             |</div><div class="line">---------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   0 | SELECT STATEMENT       |                  |</div><div class="line">|   1 |  MERGE JOIN            |                  |</div><div class="line">|   2 |   SORT JOIN            |                  |</div><div class="line">|   3 |    INDEX FAST FULL SCAN| PK_TB_TABLE_LIST |</div><div class="line">|   4 |   SORT JOIN            |                  |</div><div class="line">|   5 |    TABLE ACCESS FULL   | TB_COLUMN_LIST   |</div><div class="line">---------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 19 行。</div></pre></td></tr></table></figure>
<h3 id="查询转换相关"><a href="#查询转换相关" class="headerlink" title="查询转换相关"></a>查询转换相关</h3><p>&emsp;我们发送给ORACLE的目标SQL与最终执行的SQL有可能是不同的，oracle有可能执行一系列查询转换的操作(如视图合并，子查询展开等)将SQL改写成语义等价的其他形式，是否执行查询转换取决于ORACLE对转换后SQL执行效率的评估。</p>
<h4 id="OR扩展"><a href="#OR扩展" class="headerlink" title="OR扩展"></a>OR扩展</h4><p>&emsp;OR扩展会将OR语句改写为UNION-ALL的形式，这样各个分支各自走索引、分区修剪、表连接等互不干扰。在之前版本中使用的CONCATENATION来执行OR扩展，12.2开始采用了UNION-ALL的方式。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select A.owner,A.table_name,B.STATUS,A.column_name from TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B </div><div class="line">2 WHERE A.TABLE_NAME=B.TABLE_NAME AND A.OWNER=B.OWNER AND (B.TABLE_NAME=<span class="string">'ACCESS$'</span> OR B.OWNER=<span class="string">'XDB'</span>);</div><div class="line"></div><div class="line">......</div><div class="line"></div><div class="line">OWNER           TABLE_NAME                     STATUS     COLUMN_NAME</div><div class="line">--------------- ------------------------------ ---------- --------------------</div><div class="line">XDB             XDB_INDEX_DDL_CACHE            VALID      CONSTR_OWNER</div><div class="line">SYS             ACCESS$                        VALID      TYPES</div><div class="line">SYS             ACCESS$                        VALID      D_OBJ<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        VALID      ORDER<span class="comment">#</span></div><div class="line">SYS             ACCESS$                        VALID      COLUMNS</div><div class="line"></div><div class="line">已选择 170 行。</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'BASIC'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select A.owner,A.table_name,B.STATUS,A.column_name from</div><div class="line">TEST_ENV.TB_COLUMN_LIST A,TEST_ENV.TB_TABLE_LIST B WHERE</div><div class="line">A.TABLE_NAME=B.TABLE_NAME AND A.OWNER=B.OWNER AND</div><div class="line">(B.TABLE_NAME=<span class="string">'ACCESS$'</span> OR B.OWNER=<span class="string">'XDB'</span>)</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 1155047104</div><div class="line"></div><div class="line">-------------------------------------------------------------------------</div><div class="line">| Id  | Operation                               | Name                  |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">-------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                        |                       |</div><div class="line">|   1 |  NESTED LOOPS                           |                       |</div><div class="line">|   2 |   NESTED LOOPS                          |                       |</div><div class="line">|   3 |    VIEW                                 | VW_JF_SET<span class="variable">$ADB40ABC</span>    |</div><div class="line">|   4 |     UNION-ALL                           |                       |</div><div class="line">|   5 |      TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST         |</div><div class="line">|   6 |       INDEX RANGE SCAN                  | PK_TB_TABLE_LIST      |</div><div class="line">|   7 |      TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST         |</div><div class="line">|   8 |       INDEX RANGE SCAN                  | TB_TABLE_LIST_TBNAME  |</div><div class="line">|   9 |    INDEX RANGE SCAN                     | TB_COLUMN_LIST_TBNAME |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|  10 |   TABLE ACCESS BY INDEX ROWID           | TB_COLUMN_LIST        |</div><div class="line">-------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 25 行。</div></pre></td></tr></table></figure></p>
<h4 id="视图合并"><a href="#视图合并" class="headerlink" title="视图合并"></a>视图合并</h4><p>&emsp;将视图合并到包含它的查询块中。进行试图合并后优化器可以考虑更多的连接顺序、访问方式和其他的查询转换，以此来获取更好的性能。视图合并又分为简单视图合并和复杂视图合并。<br>1.简单视图合并<br>&emsp;对于简单试图，视图合并总是会带来更好的执行计划，所以数据库总是会进行合并而不会考虑成本。 存在以下情况时不会进行简单视图合并：</p>
<ul>
<li>视图中包含以下结构时：GROUP BY,DISTINCT,OUTER JOIN, MODEL, CONNECT BY, 集合操作, 聚合</li>
<li>视图出现在半连接或者反连接右侧时</li>
<li>视图出现在SELECT中的子查询</li>
<li>外部查询块包含PL/SQL函数</li>
</ul>
<p>&emsp;下面是一个执行了视图合并的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select A.owner,A.table_name,V_B.STATUS,A.column_name from TEST_ENV.TB_COLUMN_LIST A,</div><div class="line">    (SELECT OWNER,TABLE_NAME,STATUS FROM TEST_ENV.TB_TABLE_LIST) V_B</div><div class="line">    WHERE A.TABLE_NAME=V_B.TABLE_NAME AND A.OWNER=V_B.OWNER;</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL,NULL,<span class="string">'BASIC'</span>))</div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select A.owner,A.table_name,V_B.STATUS,A.column_name from</div><div class="line">TEST_ENV.TB_COLUMN_LIST A, (SELECT OWNER,TABLE_NAME,STATUS FROM</div><div class="line">TEST_ENV.TB_TABLE_LIST) V_B WHERE A.TABLE_NAME=V_B.TABLE_NAME AND</div><div class="line">A.OWNER=V_B.OWNER</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 4162551876</div><div class="line"></div><div class="line">---------------------------------------------</div><div class="line">| Id  | Operation          | Name           |</div><div class="line">---------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT   |                |</div><div class="line">|   1 |  HASH JOIN         |                |</div><div class="line">|   2 |   TABLE ACCESS FULL| TB_TABLE_LIST  |</div><div class="line">|   3 |   TABLE ACCESS FULL| TB_COLUMN_LIST |</div><div class="line">---------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 18 行。</div></pre></td></tr></table></figure></p>
<p>然后加个<code>no_merge</code>的hint取消视图合并，对比下执行计划。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">SQL&gt;  select A.owner,A.table_name,V_B.STATUS,A.column_name from TEST_ENV.TB_COLUMN_LIST A,</div><div class="line">      (SELECT /*+no_merge*/OWNER,TABLE_NAME,STATUS FROM TEST_ENV.TB_TABLE_LIST) V_B </div><div class="line">      WHERE A.TABLE_NAME=V_B.TABLE_NAME AND A.OWNER=V_B.OWNER;</div><div class="line"></div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select A.owner,A.table_name,V_B.STATUS,A.column_name from</div><div class="line">TEST_ENV.TB_COLUMN_LIST A, (SELECT /*+no_merge*/OWNER,TABLE_NAME,STATUS</div><div class="line">FROM TEST_ENV.TB_TABLE_LIST) V_B WHERE A.TABLE_NAME=V_B.TABLE_NAME AND</div><div class="line">A.OWNER=V_B.OWNER</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3859876297</div><div class="line"></div><div class="line">----------------------------------------------</div><div class="line">| Id  | Operation           | Name           |</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">-------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">----------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT    |                |</div><div class="line">|   1 |  HASH JOIN          |                |</div><div class="line">|   2 |   VIEW              |                |</div><div class="line">|   3 |    TABLE ACCESS FULL| TB_TABLE_LIST  |</div><div class="line">|   4 |   TABLE ACCESS FULL | TB_COLUMN_LIST |</div><div class="line">----------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 19 行。</div></pre></td></tr></table></figure></p>
<p>&emsp;可以看到第二个执行计划出现了view关键字，表示会把V_B这个视图进行单独的处理。</p>
<p>2.复杂视图合并<br>&emsp;复杂视图合并会合并包含GROUP BY和DISTINCT操作的视图，优化器会把GROUP BY和DISTINCT操作延迟到连接之后。是否进行复杂视图合并，取决于优化器对合并后性能的评估。抛开成本问题，以下情况不会进行复杂视图合并：</p>
<ul>
<li>外部查询表没有rowid或者unique column</li>
<li>视图出现在CONNECT BY查询中</li>
<li>视图包含 GROUPING SETS, ROLLUP, 或PIVOT</li>
<li>视图或者外部查询包含MODEL</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">SQL&gt; (SELECT OWNER,TABLE_NAME,COUNT(*) AS CNT_COLS FROM TEST_ENV.TB_COLUMN_LIST GROUP BY OWNER,TABLE_NAME) V_A,</div><div class="line">  2  TEST_ENV.TB_TABLE_LIST B</div><div class="line">  3  WHERE V_A.TABLE_NAME=B.TABLE_NAME AND V_A.OWNER=B.OWNER AND B.OWNER=<span class="string">'XDB'</span>;</div><div class="line">SQL&gt; select * from table(dbms_xplan.display_cursor(null, null, <span class="string">'basic'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">SELECT B.OWNER,B.TABLE_NAME,B.TABLESPACE_NAME,B.STATUS,V_A.CNT_COLS</div><div class="line">FROM (SELECT A.OWNER,A.TABLE_NAME,COUNT(*) AS CNT_COLS FROM</div><div class="line">TEST_ENV.TB_COLUMN_LIST A GROUP BY A.OWNER,A.TABLE_NAME) V_A,</div><div class="line">TEST_ENV.TB_TABLE_LIST B WHERE V_A.TABLE_NAME=B.TABLE_NAME AND</div><div class="line">V_A.OWNER=B.OWNER AND B.OWNER=<span class="string">'XDB'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 3165065995</div><div class="line"></div><div class="line">------------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">| Id  | Operation                              | Name                  |</div><div class="line">------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                       |                       |</div><div class="line">|   1 |  HASH GROUP BY                         |                       |</div><div class="line">|   2 |   NESTED LOOPS                         |                       |</div><div class="line">|   3 |    NESTED LOOPS                        |                       |</div><div class="line">|   4 |     TABLE ACCESS BY INDEX ROWID BATCHED| TB_TABLE_LIST         |</div><div class="line">|   5 |      INDEX RANGE SCAN                  | PK_TB_TABLE_LIST      |</div><div class="line">|   6 |     INDEX RANGE SCAN                   | TB_COLUMN_LIST_TBNAME |</div><div class="line">|   7 |    TABLE ACCESS BY INDEX ROWID         | TB_COLUMN_LIST        |</div><div class="line">------------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">已选择 23 行。</div></pre></td></tr></table></figure>
<p>&emsp;可以看到执行计划中已经没有VIEW关键字了，并且GROUP BY操作延迟到了嵌套循环连接之后。</p>
<h4 id="谓词推入"><a href="#谓词推入" class="headerlink" title="谓词推入"></a>谓词推入</h4><p>&emsp;优化器处理带视图的目标SQL的另一种优化手段。数据库可以将推入的谓词来访问索引或者作为过滤条件，进而走基于索引的嵌套循环连接。<br>&emsp;还是上面的列子，现在加一个<code>no_merger</code>的hint，避免做视图合并。<code>VIEW PUSHED PREDICATE</code>表明此时做的是谓词推入。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT B.OWNER,B.TABLE_NAME,B.TABLESPACE_NAME,B.STATUS,V_A.CNT_COLS FROM </div><div class="line">(SELECT /*+no_merge*/A.OWNER,A.TABLE_NAME,COUNT(*) AS CNT_COLS FROM TEST_ENV.TB_COLUMN_LIST A GROUP BY A.OWNER,A.TABLE_NAME) V_A,</div><div class="line">TEST_ENV.TB_TABLE_LIST B</div><div class="line">WHERE V_A.TABLE_NAME=B.TABLE_NAME AND V_A.OWNER=B.OWNER</div><div class="line">AND B.OWNER=<span class="string">'XDB'</span>;</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'BASIC'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">---------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">SELECT B.OWNER,B.TABLE_NAME,B.TABLESPACE_NAME,B.STATUS,V_A.CNT_COLS</div><div class="line">FROM (SELECT /*+no_merge*/A.OWNER,A.TABLE_NAME,COUNT(*) AS CNT_COLS</div><div class="line">FROM TEST_ENV.TB_COLUMN_LIST A GROUP BY A.OWNER,A.TABLE_NAME) V_A,</div><div class="line">TEST_ENV.TB_TABLE_LIST B WHERE V_A.TABLE_NAME=B.TABLE_NAME AND</div><div class="line">V_A.OWNER=B.OWNER AND B.OWNER=<span class="string">'XDB'</span></div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 466935718</div><div class="line"></div><div class="line">------------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">---------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">| Id  | Operation                              | Name                  |</div><div class="line">------------------------------------------------------------------------</div><div class="line">|   0 | SELECT STATEMENT                       |                       |</div><div class="line">|   1 |  NESTED LOOPS                          |                       |</div><div class="line">|   2 |   TABLE ACCESS BY INDEX ROWID BATCHED  | TB_TABLE_LIST         |</div><div class="line">|   3 |    INDEX RANGE SCAN                    | PK_TB_TABLE_LIST      |</div><div class="line">|   4 |   VIEW PUSHED PREDICATE                |                       |</div><div class="line">|   5 |    SORT GROUP BY                       |                       |</div><div class="line">|   6 |     TABLE ACCESS BY INDEX ROWID BATCHED| TB_COLUMN_LIST        |</div><div class="line">|   7 |      INDEX RANGE SCAN                  | TB_COLUMN_LIST_TBNAME |</div><div class="line">------------------------------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">---------------------------------------------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">已选择 23 行。</div></pre></td></tr></table></figure></p>
<h4 id="子查询展开"><a href="#子查询展开" class="headerlink" title="子查询展开"></a>子查询展开</h4><p>&emsp;在子查询展开中优化器会把嵌套的子查询转换成一个关联查询语句。只有当JOIN语句返回的数据行与原始SQL返回数据行相同，并且子查询中不包含聚合函数(如AVG)时，优化器才会执行此转换。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT OWNER,TABLE_NAME,COLUMN_NAME FROM TEST_ENV.TB_TABLE_LIST WHERE</div><div class="line">  2  (OWNER,TABLE_NAME) IN (SELECT OWNER, TABLE_NAME FROM TEST_ENV.TB_TABLE_LIST);</div><div class="line"></div><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'BASIC'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">SELECT OWNER,TABLE_NAME,COLUMN_NAME FROM TEST_ENV.TB_COLUMN_LIST WHERE</div><div class="line">(OWNER,TABLE_NAME) IN (SELECT OWNER, TABLE_NAME FROM</div><div class="line">TEST_ENV.TB_TABLE_LIST)</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 2699376560</div><div class="line"></div><div class="line">--------------------------------------------------</div><div class="line">| Id  | Operation             | Name             |</div><div class="line">--------------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   0 | SELECT STATEMENT      |                  |</div><div class="line">|   1 |  HASH JOIN            |                  |</div><div class="line">|   2 |   INDEX FAST FULL SCAN| PK_TB_TABLE_LIST |</div><div class="line">|   3 |   TABLE ACCESS FULL   | TB_COLUMN_LIST   |</div><div class="line">--------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 17 行。</div></pre></td></tr></table></figure></p>
<p>&emsp;从上面的执行计划可以看出，执行子查询展开后，表现为两个表进行HASH JOIN。我们可以使用<code>no_unnest</code>的hint来让优化器不对该SQL执行子查询展开。此时的执行计划如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(NULL, NULL, <span class="string">'BASIC'</span>));</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">EXPLAINED SQL STATEMENT:</div><div class="line">------------------------</div><div class="line">select owner,table_name,column_name from test_env.tb_column_list <span class="built_in">where</span></div><div class="line">(owner,table_name) <span class="keyword">in</span>(select /*+no_unnest*/ owner,table_name from</div><div class="line">test_env.tb_table_list)</div><div class="line"></div><div class="line">Plan <span class="built_in">hash</span> value: 2714665686</div><div class="line"></div><div class="line">-----------------------------------------------</div><div class="line">| Id  | Operation          | Name             |</div><div class="line">-----------------------------------------------</div><div class="line"></div><div class="line">PLAN_TABLE_OUTPUT</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">|   0 | SELECT STATEMENT   |                  |</div><div class="line">|   1 |  FILTER            |                  |</div><div class="line">|   2 |   TABLE ACCESS FULL| TB_COLUMN_LIST   |</div><div class="line">|   3 |   INDEX UNIQUE SCAN| PK_TB_TABLE_LIST |</div><div class="line">-----------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line">已选择 17 行。</div></pre></td></tr></table></figure></p>
<p>&emsp;不进行子查询展开后的执行计划走的是FILTER的类型的过滤了。</p>
<h4 id="表扩展"><a href="#表扩展" class="headerlink" title="表扩展"></a>表扩展</h4><p>&emsp;基于索引可以提高查询的性能，但是维护索引也会产生开销。在一个大的分区表中（特别是采用业务时间做PARTITION KEY的分区表），经常DML操作比较频繁的就几个分区，其他分区大多数时候都做的全表检索的时间比较多。在类似这种场景下我们就可以只在比较活跃的分区上面创建索引，而其他分区则不创建。优化器会自动的帮我们在有索引的分区上面通过索引检索数据，没有索引的分区进行全表扫描，然后再把结果进行UNION-ALL操作。<br>&emsp;下面是ORACLE官网的一个例子：</p>
<ol>
<li><p>表sales根据time_id进行范围分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SELECT * </div><div class="line">FROM   sales </div><div class="line">WHERE  time_id &gt;= TO_DATE(<span class="string">'2000-01-01 00:00:00'</span>, <span class="string">'SYYYY-MM-DD HH24:MI:SS'</span>) </div><div class="line">AND    prod_id = 38;</div></pre></td></tr></table></figure>
</li>
<li><p>执行该语句得到的执行计划如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Plan <span class="built_in">hash</span> value: 3087065703</div><div class="line"> </div><div class="line">--------------------------------------------------------------------------</div><div class="line">|Id| Operation                                  | Name      |Pstart|Pstop|</div><div class="line">--------------------------------------------------------------------------</div><div class="line">| 0| SELECT STATEMENT                           |              |    |    |</div><div class="line">| 1|  PARTITION RANGE ITERATOR                  |              | 13 | 28 |</div><div class="line">| 2|   TABLE ACCESS BY LOCAL INDEX ROWID BATCHED| SALES        | 13 | 28 |</div><div class="line">| 3|    BITMAP CONVERSION TO ROWIDS             |              |    |    |</div><div class="line">|*4|     BITMAP INDEX SINGLE VALUE              |SALES_PROD_BIX| 13 | 28 |</div><div class="line">--------------------------------------------------------------------------</div><div class="line"> </div><div class="line">Predicate Information (identified by operation id):</div><div class="line">---------------------------------------------------</div><div class="line"> </div><div class="line">   4 - access(<span class="string">"PROD_ID"</span>=38)</div></pre></td></tr></table></figure>
</li>
<li><p>然后将sales_q4_2003分区的索引禁用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ALTER INDEX sales_prod_bix MODIFY PARTITION sales_q4_2003 UNUSABLE;</div><div class="line">ALTER INDEX sales_time_bix MODIFY PARTITION sales_q4_2003 UNUSABLE;</div></pre></td></tr></table></figure>
</li>
<li><p>此时数据库在有索引的分区采用索引检索数据，对没有索引的分区进行全表扫描。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Plan hash value: 2120767686</div><div class="line"> </div><div class="line">---------------------------------------------------------------------------</div><div class="line">|Id| Operation                                    | Name     |Pstart|Pstop|</div><div class="line">---------------------------------------------------------------------------</div><div class="line">| 0| SELECT STATEMENT                             |               |   |   |</div><div class="line">| 1|  VIEW                                        | VW_TE_2       |   |   |</div><div class="line">| 2|   UNION-ALL                                  |               |   |   |</div><div class="line">| 3|    PARTITION RANGE ITERATOR                  |               | 13| 27|</div><div class="line">| 4|     TABLE ACCESS BY LOCAL INDEX ROWID BATCHED| SALES         | 13| 27|</div><div class="line">| 5|      BITMAP CONVERSION TO ROWIDS             |               |   |   |</div><div class="line">|*6|       BITMAP INDEX SINGLE VALUE              | SALES_PROD_BIX| 13| 27|</div><div class="line">| 7|    PARTITION RANGE SINGLE                    |               | 28| 28|</div><div class="line">|*8|     TABLE ACCESS FULL                        | SALES         | 28| 28|</div><div class="line">---------------------------------------------------------------------------</div><div class="line"> </div><div class="line">Predicate Information (identified by operation id):</div><div class="line">---------------------------------------------------</div><div class="line"> </div><div class="line">   6 - access(&quot;PROD_ID&quot;=38)</div><div class="line">   8 - filter(&quot;PROD_ID&quot;=38)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>&emsp;通过将非活跃分区的索引删除的方式可以减少维护索引的成本，优化器会自动的帮我们进行查询的改写，而不影响我们原本的SQL语句。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ORACLE/" rel="tag"># ORACLE</a>
          
            <a href="/tags/SQL优化/" rel="tag"># SQL优化</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/19/oracle-sql-plan-management/" rel="next" title="稳定ORACLE的执行计划">
                <i class="fa fa-chevron-left"></i> 稳定ORACLE的执行计划
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MDUwMC8xNzAyNw=="></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/header.jpg"
               alt="L4J" />
          <p class="site-author-name" itemprop="name">L4J</p>
           
              <p class="site-description motion-element" itemprop="description">不务正业的CODER，当了一个假的DBA</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#表访问相关"><span class="nav-number">1.</span> <span class="nav-text">表访问相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Full-Table-Scans"><span class="nav-number">1.1.</span> <span class="nav-text">Full Table Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Table-Access-By-Rowid"><span class="nav-number">1.2.</span> <span class="nav-text">Table Access By Rowid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sample-Table-Scans"><span class="nav-number">1.3.</span> <span class="nav-text">Sample Table Scans</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-tree索引相关"><span class="nav-number">2.</span> <span class="nav-text">B-tree索引相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Unique-Scans"><span class="nav-number">2.1.</span> <span class="nav-text">Index Unique Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Range-Scans"><span class="nav-number">2.2.</span> <span class="nav-text">Index Range Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Full-Scans"><span class="nav-number">2.3.</span> <span class="nav-text">Index Full Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Fast-Full-Scans"><span class="nav-number">2.4.</span> <span class="nav-text">Index Fast Full Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Skip-Scans"><span class="nav-number">2.5.</span> <span class="nav-text">Index Skip Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Index-Join-Scans"><span class="nav-number">2.6.</span> <span class="nav-text">Index Join Scans</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bitmap索引相关"><span class="nav-number">3.</span> <span class="nav-text">Bitmap索引相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Bitmap-Conversion-to-Rowid"><span class="nav-number">3.1.</span> <span class="nav-text">Bitmap Conversion to Rowid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bitmap-Index-Single-Value"><span class="nav-number">3.2.</span> <span class="nav-text">Bitmap Index Single Value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bitmap-Index-Range-Scans"><span class="nav-number">3.3.</span> <span class="nav-text">Bitmap Index Range Scans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bitmap-Merge"><span class="nav-number">3.4.</span> <span class="nav-text">Bitmap Merge</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表连接相关"><span class="nav-number">4.</span> <span class="nav-text">表连接相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Nested-Loops-Joins"><span class="nav-number">4.1.</span> <span class="nav-text">Nested Loops Joins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hash-Joins"><span class="nav-number">4.2.</span> <span class="nav-text">Hash Joins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sorted-Merge-Joins"><span class="nav-number">4.3.</span> <span class="nav-text">Sorted Merge Joins</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询转换相关"><span class="nav-number">5.</span> <span class="nav-text">查询转换相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OR扩展"><span class="nav-number">5.1.</span> <span class="nav-text">OR扩展</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#视图合并"><span class="nav-number">5.2.</span> <span class="nav-text">视图合并</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#谓词推入"><span class="nav-number">5.3.</span> <span class="nav-text">谓词推入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子查询展开"><span class="nav-number">5.4.</span> <span class="nav-text">子查询展开</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表扩展"><span class="nav-number">5.5.</span> <span class="nav-text">表扩展</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" style="text-align:center">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="author" itemprop="copyrightHolder">&nbsp;&nbsp;&nbsp;L4J'blog</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  





  

  

  

  

  

  

</body>
</html>
